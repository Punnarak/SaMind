{"version":3,"sources":["BaseCalendar.tsx"],"names":["React","useEffect","useState","useCallback","View","dayjs","localeData","localizedFormat","utc","getSurroundingTimeUnits","useSurroundingTimeUnits","ThemeContext","LocaleContext","VIEW","Months","Days","Arrow","DefaultArrow","Title","DefaultTitle","Weekdays","DefaultWeekdays","extend","BaseCalendar","ArrowComponent","CustomArrow","TitleComponent","CustomTitle","WeekdaysComponent","CustomWeekdays","DayComponent","MonthComponent","allowYearView","showExtraDates","onPressDay","maxDate","minDate","initVisibleDate","dateProperties","testID","theme","useContext","locale","rightArrowDisabled","disableRightArrow","leftArrowDisabled","disableLeftArrow","activeView","setActiveView","MONTH","visibleDate","setVisibleDate","local","format","localeAwareVisibleDate","useMemo","name","weekdays","weekdaysShort","month","year","verifyUnitIsPastMaxDate","unit","isAfter","verifyUnitIsBeforeMinDate","isBefore","toggleCalendarView","newVisibleDate","_month","_year","YEAR","next","last","start","end","addMonth","afterNext","current","subtractMonth","beforeLast","addYear","persistMonth","subtractYear","onPressMonth","calendarContainer","headerContainer","undefined"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useCallback } from 'react';\nimport { View } from 'react-native';\nimport dayjs from 'dayjs';\n\nimport localeData from 'dayjs/plugin/localeData';\nimport localizedFormat from 'dayjs/plugin/localizedFormat';\nimport utc from 'dayjs/plugin/utc';\n\nimport { getSurroundingTimeUnits } from '../Utils';\nimport { useSurroundingTimeUnits } from '../Hooks';\nimport { ThemeContext, LocaleContext } from '../Contexts';\nimport { VIEW } from '../Constants';\n\nimport {\n  Months,\n  Days,\n  Arrow as DefaultArrow,\n  Title as DefaultTitle,\n  Weekdays as DefaultWeekdays,\n} from '../Components';\n\nimport type {\n  Theme,\n  Locale,\n  ArrowComponentType,\n  TitleComponentType,\n  DayComponentType,\n  MonthComponentType,\n  WeekdaysComponentType,\n} from '../Entities';\n\ndayjs.extend(localeData);\ndayjs.extend(localizedFormat);\ndayjs.extend(utc);\n\nexport interface Props {\n  ArrowComponent?: ArrowComponentType;\n  TitleComponent?: TitleComponentType;\n  DayComponent?: DayComponentType;\n  MonthComponent?: MonthComponentType;\n  WeekdaysComponent?: WeekdaysComponentType;\n  testID?: string;\n  showExtraDates?: boolean;\n  allowYearView?: boolean; // Boolean that disables the calendar year view\n  onPressDay: (date: string) => void; // Recieves a date format string\n  minDate?: string; // YYYY-MM-DD format string respresenting the minimum date that can be selected\n  maxDate?: string; // YYYY-MM-DD format string respresenting the maximum date that can be selected\n  initVisibleDate?: string; // YYYY-MM-DD format string respresenting the date that should be visible when the calendar first renders\n  dateProperties: {\n    [date: string /* YYYY-MM-DD */]: {\n      isSelected?: boolean;\n    };\n  };\n}\n\nconst BaseCalendar: React.FC<Props> = ({\n  ArrowComponent: CustomArrow,\n  TitleComponent: CustomTitle,\n  WeekdaysComponent: CustomWeekdays,\n  DayComponent,\n  MonthComponent,\n  allowYearView,\n  showExtraDates,\n  onPressDay,\n  maxDate,\n  minDate,\n  initVisibleDate,\n  dateProperties,\n  testID,\n}) => {\n  const theme = React.useContext<Theme>(ThemeContext);\n  const locale = React.useContext<Locale>(LocaleContext);\n\n  const [rightArrowDisabled, disableRightArrow] = useState<boolean>(false);\n  const [leftArrowDisabled, disableLeftArrow] = useState<boolean>(false);\n  const [activeView, setActiveView] = useState<VIEW>(VIEW.MONTH);\n  const [visibleDate, setVisibleDate] = useState<string>(\n    initVisibleDate ?? dayjs().local().format()\n  );\n\n  const localeAwareVisibleDate = React.useMemo(\n    () => dayjs(visibleDate).locale(locale.name, locale),\n    [locale, visibleDate]\n  );\n\n  const weekdays = React.useMemo(() => locale.weekdaysShort ?? [''], [locale]);\n\n  const { month, year } = useSurroundingTimeUnits(visibleDate);\n\n  const verifyUnitIsPastMaxDate = useCallback(\n    (unit) => {\n      if (maxDate) {\n        if (unit.isAfter(maxDate)) {\n          disableRightArrow(true);\n        } else {\n          disableRightArrow(false);\n        }\n      }\n    },\n    [disableRightArrow, maxDate]\n  );\n\n  const verifyUnitIsBeforeMinDate = useCallback(\n    (unit) => {\n      if (minDate) {\n        if (unit.isBefore(minDate)) {\n          disableLeftArrow(true);\n        } else {\n          disableLeftArrow(false);\n        }\n      }\n    },\n    [disableLeftArrow, minDate]\n  );\n\n  const toggleCalendarView = useCallback(\n    (newVisibleDate: string = visibleDate) => {\n      const { month: _month, year: _year } = getSurroundingTimeUnits(newVisibleDate);\n\n      if (activeView === VIEW.MONTH) {\n        setActiveView(VIEW.YEAR);\n        verifyUnitIsPastMaxDate(_year.next);\n        verifyUnitIsBeforeMinDate(_year.last);\n      }\n\n      if (activeView === VIEW.YEAR) {\n        setActiveView(VIEW.MONTH);\n        verifyUnitIsPastMaxDate(_month.next);\n        verifyUnitIsBeforeMinDate(_month.last);\n      }\n    },\n    [activeView, verifyUnitIsBeforeMinDate, verifyUnitIsPastMaxDate, visibleDate]\n  );\n\n  useEffect(() => {\n    verifyUnitIsPastMaxDate(month.next.start);\n    verifyUnitIsBeforeMinDate(month.last.end);\n  }, [\n    month.last.end,\n    month.next.start,\n    verifyUnitIsPastMaxDate,\n    verifyUnitIsBeforeMinDate,\n  ]);\n\n  const addMonth = useCallback(() => {\n    setVisibleDate(month.next.start.local().format());\n    verifyUnitIsPastMaxDate(month.afterNext);\n    verifyUnitIsBeforeMinDate(month.current.end);\n  }, [month, verifyUnitIsBeforeMinDate, verifyUnitIsPastMaxDate]);\n\n  const subtractMonth = useCallback(() => {\n    setVisibleDate(month.last.start.local().format());\n    verifyUnitIsPastMaxDate(month.current.start);\n    verifyUnitIsBeforeMinDate(month.beforeLast);\n  }, [month, verifyUnitIsBeforeMinDate, verifyUnitIsPastMaxDate]);\n\n  const addYear = useCallback(() => {\n    setVisibleDate(year.next.persistMonth.local().format());\n    verifyUnitIsPastMaxDate(year.afterNext);\n    verifyUnitIsBeforeMinDate(year.current.end);\n  }, [year, verifyUnitIsBeforeMinDate, verifyUnitIsPastMaxDate]);\n\n  const subtractYear = useCallback(() => {\n    setVisibleDate(year.last.persistMonth.local().format());\n    verifyUnitIsPastMaxDate(year.current.start);\n    verifyUnitIsBeforeMinDate(year.beforeLast);\n  }, [year, verifyUnitIsBeforeMinDate, verifyUnitIsPastMaxDate]);\n\n  const onPressMonth = (newVisibleDate: string) => {\n    setVisibleDate(newVisibleDate);\n    toggleCalendarView(newVisibleDate);\n  };\n\n  const Weekdays = CustomWeekdays || DefaultWeekdays;\n  const Arrow = CustomArrow || DefaultArrow;\n  const Title = CustomTitle || DefaultTitle;\n\n  return (\n    <View style={theme.calendarContainer} testID={testID}>\n      <View testID={'header'} style={theme.headerContainer}>\n        <Arrow\n          direction={'left'}\n          isDisabled={leftArrowDisabled}\n          onPress={activeView === VIEW.MONTH ? subtractMonth : subtractYear}\n        />\n        <Title\n          activeView={activeView}\n          locale={locale}\n          date={localeAwareVisibleDate.format('YYYY-MM-DD')}\n          isDisabled={!allowYearView}\n          onPress={toggleCalendarView}\n        />\n        <Arrow\n          direction={'right'}\n          isDisabled={rightArrowDisabled}\n          onPress={activeView === VIEW.MONTH ? addMonth : addYear}\n        />\n      </View>\n      {activeView === VIEW.MONTH ? (\n        <>\n          <Weekdays days={weekdays} />\n          <Days\n            DayComponent={DayComponent}\n            visibleDate={localeAwareVisibleDate}\n            showExtraDates={!!showExtraDates}\n            dateProperties={dateProperties}\n            onPressDay={onPressDay}\n            minDate={minDate}\n            maxDate={maxDate}\n          />\n        </>\n      ) : (\n        <Months\n          MonthComponent={MonthComponent}\n          visibleDate={localeAwareVisibleDate}\n          minDate={minDate ? dayjs(minDate).local().format() : undefined}\n          maxDate={maxDate ? dayjs(maxDate).local().format() : undefined}\n          dateProperties={dateProperties}\n          onPressMonth={onPressMonth}\n        />\n      )}\n    </View>\n  );\n};\n\nexport default BaseCalendar;\n"]}